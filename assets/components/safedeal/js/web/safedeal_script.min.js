$(document).ready(()=>{$(".js-hidden-refresh").on("hidden.bs.modal",(function(e){location.href=location.href})),$(".js-dealprice").on("change keyup",e=>{$(".js-dealfee").text(($(e.target).val().replace(/,/g,"")*$(e.target).data("fee")).toLocaleString())}),$(".js-iagreecheck").on("change",e=>{let form;form=$(e.target).data("form")?$(e.target).data("form"):$(e.target).closest("form"),$(form).find('[type="submit"]').removeAttr("disabled"),$(e.target).data("parent")?$($(e.target).data("parent")).find(".js-iagreecheck").each((i,el)=>{$(el).is(":checked")||$(form).find('[type="submit"]').attr("disabled","")}):$(e.target).is(":checked")?$(form).find('[type="submit"]').removeAttr("disabled"):$(form).find('[type="submit"]').attr("disabled","")})}),function(){const result={init:function(){this.eventSubscription()},eventSubscription:function(){$(document).on("af_complete",$.proxy(this.eventAfComplete,this))},eventAfComplete:function(event,response){"service"in response.data&&"safedeal"==response.data.service&&(this.cleanDOM(response),this.offLibraries(response),this.getService(response))},cleanDOM:function(response){$(response.form).find(".is-invalid").removeClass("is-invalid"),$(response.form).find(".invalid-feedback").remove(),$(response.form).find(".alert").hide()},offLibraries:function(response){response.message=""},getService:function(response){let modalID,alertClass,alert=response.form.find(".alert");"modalID"in response.data&&(modalID=response.data.modalID),response.data.result?("location"in response.data&&(window.location=response.data.location),alertClass="alert-success"):(alertClass="alert-danger",$.each(response.data.errors,(i,msg)=>{response.form.find('[name="'+i+'"]').addClass("is-invalid").after($('<span class="invalid-feedback">'+msg+"</span>")),response.form.attr("id")&&$("body").find('[form="'+response.form.attr("id")+'"][name="'+i+'"]').addClass("is-invalid").after($('<span class="invalid-feedback">'+msg+"</span>"))})),modalID&&($(".modal").modal("hide"),"hash_link"in response.data&&$(".modal").find("#DealLink").length>0&&$(".modal").find("#DealLink").val(response.data.hash_link),$("#"+modalID).modal("show")),alert.length>0&&response.data.message&&alert.show().attr("class",alert.attr("class").replace(/\balert-\w*\b/g,"")).addClass(alertClass).text(response.data.message)}};result.init()}();